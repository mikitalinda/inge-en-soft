<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>FarmaGo — Inicio</title>

    <!-- Tailwind (CDN para prototipo) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Leaflet (mapa) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
      /* Pequeños ajustes locales */
      .main-container{max-width:1200px;margin:0 auto;padding:0 1rem;}
      .card-shadow{box-shadow:0 6px 18px rgba(15,23,42,0.06);}
    </style>
  </head>
  <body class="bg-gray-50 text-gray-800">

    <!-- NAVBAR -->
    <header class="bg-white shadow-sm">
      <div class="main-container flex items-center justify-between py-4">
        <div class="flex items-center gap-3">
          <img src="{{ url_for('static', filename='logo.jpeg') }}" alt="FarmaGo" class="h-12 w-auto">
          <a href="{{ url_for('home') }}" class="text-xl font-semibold">FarmaGo</a>
        </div>

        <nav class="hidden md:flex items-center gap-6">
          <a href="{{ url_for('productos') }}" class="text-gray-600 hover:text-green-600">Productos</a>
          <a href="#servicios" class="text-gray-600 hover:text-green-600">Servicios</a>
          <a href="{{ url_for('login') }}" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">Iniciar sesión</a>
        </nav>

        <div class="md:hidden">
          <a href="{{ url_for('login') }}" class="px-3 py-2 bg-green-600 text-white rounded-md">Entrar</a>
        </div>
      </div>
    </header>

    <!-- HERO -->
    <section class="bg-white">
      <div class="main-container grid grid-cols-1 md:grid-cols-2 gap-8 items-center py-12">
        <div>
          <h1 class="text-3xl md:text-4xl font-extrabold leading-tight">Sistema de búsqueda en farmacias cercanas que te muestra dónde encontrar tu medicamento y al mejor precio.</h1>
          <p class="mt-4 text-gray-600">Encuentra tus medicamentos en las farmacias más cercanas, compara precios y verifica disponibilidad en tiempo real.</p>

          <div class="mt-6 flex gap-3">
            <a href="#productos" class="px-5 py-3 bg-green-600 text-white rounded-md hover:bg-green-700">Buscar medicamentos</a>
            <a href="#servicios" class="px-5 py-3 border border-gray-200 text-gray-700 rounded-md hover:bg-gray-50">Nuestros servicios</a>
          </div>
        </div>

        <div class="w-full flex justify-center items-center">
          <img src="{{ url_for('static', filename='logo.jpeg') }}" alt="FarmaGo Logo" class="w-64 h-64 object-contain">
        </div>
      </div>
    </section>

    <!-- PRODUCTOS -->
    <section id="productos" class="py-12">
      <div class="main-container">
        <div class="flex items-center justify-between">
          <h2 class="text-2xl font-semibold">Productos destacados</h2>
          <a href="#" class="text-green-600 hover:text-green-700">Ver todos</a>
        </div>

        <div class="mt-6 grid gap-6 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
          <!-- Paracetamol -->
          <article class="bg-white rounded-lg overflow-hidden card-shadow hover:shadow-lg transition-shadow">
            <div class="relative">
              <div class="w-full h-48 bg-gray-100 flex items-center justify-center">
                <div class="text-gray-400 text-center p-4">
                  <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                  </svg>
                  <span class="text-sm">Paracetamol 500mg</span>
                </div>
              </div>
              <div class="absolute top-2 right-2 bg-green-100 text-green-800 text-xs px-2 py-1 rounded">En stock</div>
            </div>
            <div class="p-4">
              <h3 class="font-semibold">Paracetamol 500mg</h3>
              <p class="text-sm text-gray-500 mt-1">20 comprimidos</p>
              <div class="mt-3 flex items-center justify-between">
                <div>
                  <div class="text-lg font-bold">$5.99</div>
                  <div class="text-xs text-gray-500">Precio por unidad</div>
                </div>
                <button class="px-4 py-2 text-sm bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">
                  Agregar al carrito
                </button>
              </div>
            </div>
          </article>

          <!-- Vitamina C -->
          <article class="bg-white rounded-lg overflow-hidden card-shadow hover:shadow-lg transition-shadow">
            <div class="relative">
              <div class="w-full h-48 bg-gray-100 flex items-center justify-center">
                <div class="text-gray-400 text-center p-4">
                  <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                  </svg>
                  <span class="text-sm">Vitamina C 1000mg</span>
                </div>
              </div>
              <div class="absolute top-2 right-2 bg-green-100 text-green-800 text-xs px-2 py-1 rounded">En stock</div>
            </div>
            <div class="p-4">
              <h3 class="font-semibold">Vitamina C 1000mg</h3>
              <p class="text-sm text-gray-500 mt-1">30 cápsulas</p>
              <div class="mt-3 flex items-center justify-between">
                <div>
                  <div class="text-lg font-bold">$8.99</div>
                  <div class="text-xs text-gray-500">Precio por frasco</div>
                </div>
                <button class="px-4 py-2 text-sm bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">
                  Agregar al carrito
                </button>
              </div>
            </div>
          </article>

          <!-- Crema Hidratante -->
          <article class="bg-white rounded-lg overflow-hidden card-shadow hover:shadow-lg transition-shadow">
            <div class="relative">
              <div class="w-full h-48 bg-gray-100 flex items-center justify-center">
                <div class="text-gray-400 text-center p-4">
                  <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                  </svg>
                  <span class="text-sm">Crema Hidratante 100ml</span>
                </div>
              </div>
              <div class="absolute top-2 right-2 bg-green-100 text-green-800 text-xs px-2 py-1 rounded">En stock</div>
            </div>
            <div class="p-4">
              <h3 class="font-semibold">Crema Hidratante 100ml</h3>
              <p class="text-sm text-gray-500 mt-1">Cuidado diario</p>
              <div class="mt-3 flex items-center justify-between">
                <div>
                  <div class="text-lg font-bold">$12.00</div>
                  <div class="text-xs text-gray-500">Precio por unidad</div>
                </div>
                <button class="px-4 py-2 text-sm bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">
                  Agregar al carrito
                </button>
              </div>
            </div>
          </article>

          <!-- Termómetro Digital -->
          <article class="bg-white rounded-lg overflow-hidden card-shadow hover:shadow-lg transition-shadow">
            <div class="relative">
              <div class="w-full h-48 bg-gray-100 flex items-center justify-center">
                <div class="text-gray-400 text-center p-4">
                  <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  <span class="text-sm">Termómetro Digital</span>
                </div>
              </div>
              <div class="absolute top-2 right-2 bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded">Últimas unidades</div>
            </div>
            <div class="p-4">
              <h3 class="font-semibold">Termómetro Digital</h3>
              <p class="text-sm text-gray-500 mt-1">Medición precisa</p>
              <div class="mt-3 flex items-center justify-between">
                <div>
                  <div class="text-lg font-bold">$15.99</div>
                  <div class="text-xs text-gray-500">Precio por unidad</div>
                </div>
                <button class="px-4 py-2 text-sm bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">
                  Agregar al carrito
                </button>
              </div>
            </div>
          </article>
        </div>
      </div>
    </section>

    <!-- SERVICIOS (incluye mapa de entregas) -->
    <section id="servicios" class="py-12 bg-gray-50">
      <div class="main-container">
        <h2 class="text-2xl font-semibold mb-8">Nuestros servicios</h2>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <!-- Entrega a domicilio con mapa -->
          <div class="bg-white p-6 rounded-lg card-shadow">
            <h3 class="text-xl font-semibold mb-2">Entrega a domicilio</h3>
            <p class="text-gray-600 mb-4">Verifica si tu dirección está dentro del rango de entrega. Usa tu ubicación para comprobar disponibilidad.</p>

            <div id="delivery-map" class="w-full rounded-md overflow-hidden border" style="height:220px;"></div>

            <div class="mt-3 flex items-center gap-3">
              <button id="loc-btn" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm">Usar mi ubicación</button>
              <button id="reset-map" class="px-3 py-2 border rounded text-sm">Mostrar todo</button>
              <div id="delivery-status" class="ml-auto text-sm text-gray-700"></div>
            </div>

            <p class="text-xs text-gray-500 mt-3">Radio de entrega: <strong id="delivery-km-text">8 km</strong></p>
          </div>

          <!-- Consulta farmacéutica (subida de recetas y validación) -->
          <div class="bg-white p-6 rounded-lg card-shadow">
            <h3 class="text-xl font-semibold mb-2">Consulta farmacéutica</h3>
            <p class="text-gray-600 mb-4">Sube tu receta médica para que un profesional certificado la revise. Si corresponde, el médico confirmará si la receta es válida y si el medicamento está cubierto por tu obra social o debe ser particular.</p>

            <div class="grid gap-3">
              <label class="text-sm font-medium">Tipo de cobertura</label>
              <select id="coverage-type" class="rounded-md border-gray-200 p-2 max-w-xs">
                <option value="particular">Particular</option>
                <option value="obra_social">Obra social / Prepagas</option>
              </select>

              <div id="obra-fields" class="hidden space-y-2">
                <div>
                  <label class="text-sm">Obra social / Prepaga</label>
                  <input id="obra-name" type="text" placeholder="Nombre de la obra social" class="mt-1 block w-full rounded-md border-gray-200 p-2">
                </div>
                <div>
                  <label class="text-sm">Número de afiliado</label>
                  <input id="obra-id" type="text" placeholder="N° de afiliado" class="mt-1 block w-full rounded-md border-gray-200 p-2">
                </div>
              </div>

              <div>
                <label class="text-sm font-medium">Sube tu receta (PDF o imagen)</label>
                <div class="mt-2 space-y-3">
                  <input id="prescription-file" type="file" accept="application/pdf,image/*" class="block w-full">
                  <div class="flex justify-end">
                    <button id="submit-prescription" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700" type="button">Enviar receta</button>
                  </div>
                </div>
                <div id="prescription-info" class="text-sm text-gray-500 mt-2">Tamaño máximo recomendado: 5 MB. Formatos aceptados: PDF, JPG, PNG.</div>
              </div>

              <div id="prescription-status" class="mt-3 text-sm"></div>

              <div class="mt-2 text-xs text-gray-500">
                Nota: todas las recetas son revisadas por un profesional médico certificado. La validación médica es obligatoria antes de confirmar cobertura o despacho. El proceso puede tardar hasta 24 horas en casos reales; aquí simulamos la comprobación en el cliente para la demo.
              </div>
            </div>
          </div>

          <!-- (Tarjeta "Atención 24/7" eliminada - espacio disponible para futuras funcionalidades) -->
        </div>
      </div>
    </section>

    <!-- FOOTER -->
    <footer class="bg-white border-t mt-12">
      <div class="main-container py-8 flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
        <div>
          <h4 class="font-semibold text-lg">FarmaGo</h4>
          <p class="text-gray-600 mt-2">Tu salud es nuestra prioridad</p>
        </div>
        <div class="flex gap-6">
          <a href="#" class="text-gray-600 hover:text-green-600">Términos</a>
          <a href="#" class="text-gray-600 hover:text-green-600">Privacidad</a>
          <a href="#" class="text-gray-600 hover:text-green-600">Contacto</a>
        </div>
      </div>
    </footer>

    <!-- Script: mapa (solo front-end, sin cambios en backend) -->
    <script>
      (function(){
        // Coordenadas y radio en km — editar aquí si necesitas cambiar sin tocar backend
        const PHARMACY_LAT = -34.603722   // ejemplo; cambia a tus coordenadas
        const PHARMACY_LNG = -58.381592
        const DELIVERY_KM = 8
        const DELIVERY_METERS = DELIVERY_KM * 1000

        document.getElementById('delivery-km-text').textContent = DELIVERY_KM + ' km'

        // Inicializar mapa
        const map = L.map('delivery-map', { zoomControl: false }).setView([PHARMACY_LAT, PHARMACY_LNG], 13)

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map)

        const pharmacyMarker = L.marker([PHARMACY_LAT, PHARMACY_LNG]).addTo(map).bindPopup('FarmaGo')
        const circle = L.circle([PHARMACY_LAT, PHARMACY_LNG], {
          color: '#16a34a',
          fillColor: '#a7f3d0',
          fillOpacity: 0.15,
          radius: DELIVERY_METERS
        }).addTo(map)

        map.fitBounds(circle.getBounds(), { padding: [20, 20] })

        const statusEl = document.getElementById('delivery-status')
        const locBtn = document.getElementById('loc-btn')
        const resetBtn = document.getElementById('reset-map')
        let userMarker = null

        function showStatus(message, ok){
          statusEl.textContent = message
          statusEl.classList.toggle('text-green-700', !!ok)
          statusEl.classList.toggle('text-red-600', !ok)
        }

        locBtn.addEventListener('click', () => {
          if (!navigator.geolocation) {
            showStatus('Geolocalización no disponible en este navegador.', false)
            return
          }
          showStatus('Obteniendo ubicación…', true)
          navigator.geolocation.getCurrentPosition(pos => {
            const lat = pos.coords.latitude
            const lng = pos.coords.longitude

            if (userMarker) map.removeLayer(userMarker)
            userMarker = L.marker([lat, lng], {opacity:0.9}).addTo(map).bindPopup('Tu ubicación').openPopup()

            const distMeters = L.latLng(lat, lng).distanceTo(L.latLng(PHARMACY_LAT, PHARMACY_LNG))
            const distKm = (distMeters/1000).toFixed(2)

            if (distMeters <= DELIVERY_METERS) {
              const speedKmh = 30
              const mins = Math.max(5, Math.round((distMeters/1000) / speedKmh * 60))
              showStatus(`Envío disponible — aprox. ${mins} min (distancia ${distKm} km)`, true)
            } else {
              showStatus(`Fuera de zona de entrega — distancia ${distKm} km`, false)
            }

            const bounds = L.latLngBounds([[lat,lng],[PHARMACY_LAT,PHARMACY_LNG]])
            map.fitBounds(bounds.pad(0.3))
          }, err => {
            showStatus('No se pudo obtener la ubicación. Permisos denegados o error.', false)
          }, { enableHighAccuracy: true, timeout: 10000 })
        })

        resetBtn.addEventListener('click', () => {
          if (userMarker) { map.removeLayer(userMarker); userMarker = null }
          map.fitBounds(circle.getBounds(), { padding: [20,20] })
          statusEl.textContent = ''
          statusEl.classList.remove('text-green-700','text-red-600')
        })
      })()
    </script>
    <script>
      // Manejo frontend de subida y validación simulada de recetas
      (function(){
        const coverageSelect = document.getElementById('coverage-type')
        const obraFields = document.getElementById('obra-fields')
        const fileInput = document.getElementById('prescription-file')
        const submitBtn = document.getElementById('submit-prescription')
        const statusEl = document.getElementById('prescription-status')

        const MAX_BYTES = 5 * 1024 * 1024 // 5MB

        coverageSelect?.addEventListener('change', (e) => {
          if (e.target.value === 'obra_social') {
            obraFields.classList.remove('hidden')
          } else {
            obraFields.classList.add('hidden')
          }
        })

        function showStatus(message, kind) {
          // kind: 'info' | 'ok' | 'error' | 'warn'
          statusEl.textContent = message
          statusEl.className = 'mt-3 text-sm'
          if (kind === 'ok') statusEl.classList.add('text-green-700')
          else if (kind === 'error') statusEl.classList.add('text-red-600')
          else if (kind === 'warn') statusEl.classList.add('text-yellow-600')
          else statusEl.classList.add('text-gray-700')
        }

        submitBtn?.addEventListener('click', () => {
          const file = fileInput.files && fileInput.files[0]
          const coverage = coverageSelect.value

          // Basic validations
          if (!file) { showStatus('Por favor selecciona un archivo de receta.', 'error'); return }
          if (file.size > MAX_BYTES) { showStatus('El archivo supera 5 MB. Reduce el tamaño o sube una versión comprimida.', 'error'); return }
          const allowed = ['application/pdf','image/jpeg','image/png']
          if (!allowed.includes(file.type)) { showStatus('Formato no soportado. Usa PDF, JPG o PNG.', 'error'); return }

          // If obra social selected, require fields
          if (coverage === 'obra_social') {
            const name = document.getElementById('obra-name').value.trim()
            const id = document.getElementById('obra-id').value.trim()
            if (!name || !id) { showStatus('Completa nombre de obra social y número de afiliado.', 'error'); return }
          }

          // Show upload simulation
          showStatus('Subiendo receta…', 'info')
          submitBtn.disabled = true

          // Simulate async upload and medical review
          setTimeout(() => {
            showStatus('Receta recibida. Enviando a revisión por profesional médico certificado…', 'info')

            // Simulate review time
            setTimeout(() => {
              // Randomized demo outcome
              const rand = Math.random()
              if (rand < 0.65) {
                // Approved
                const covered = (coverage === 'obra_social') ? (Math.random() < 0.8) : false
                if (covered) {
                  showStatus('Receta validada. La obra social cubrirá el medicamento. Te confirmaremos por email/telefono.', 'ok')
                } else if (coverage === 'obra_social') {
                  showStatus('Receta validada, pero la obra social NO cubre este medicamento. Se podrá comprar como particular.', 'warn')
                } else {
                  showStatus('Receta validada. Puedes retirar el medicamento como particular.', 'ok')
                }
              } else if (rand < 0.9) {
                showStatus('La receta requiere aclaración: el profesional solicitó información adicional (dosis o firma). Re-sube una versión corregida.', 'warn')
              } else {
                showStatus('La receta fue rechazada por inconsistencias. Contacta a tu médico.', 'error')
              }
              submitBtn.disabled = false
            }, 2200)
          }, 900)
        })
      })()
    </script>
  </body>
</html>